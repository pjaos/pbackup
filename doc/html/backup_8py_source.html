<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pbackup: pbackup/backup.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pbackup
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9cb12bca83332f873cab06344518ea77.html">pbackup</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">backup.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="backup_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespacepbackup_1_1backup.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/python3</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span>  sys</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span>  os</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">from</span>    optparse <span class="keyword">import</span> OptionParser</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">from</span>    subprocess <span class="keyword">import</span> check_output, STDOUT</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">import</span>  time</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">import</span>  smtplib</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">import</span>  socket</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">import</span>  pickle</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">import</span>  getpass</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">import</span>  shutil</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">import</span>  datetime</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1BackupError.html">   15</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(Exception):</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;@brief An excption raised during the backup process.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html">   19</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpbackup_1_1backup_1_1UO.html">UO</a>(object):</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;@brief responsible for user viewable output.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html#ae64f0875afe3067b97ba370b354b9213">   21</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1UO.html#ae64f0875afe3067b97ba370b354b9213">__init__</a>(self):</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a1f9f69d9f49237b89f708c27b962ef4b">_logFile</a> = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a4d94847acb7b98bea7a74c809a640f8f">_outputStore</a> = []</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keyword">def </span>_output(self, msg):</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Output the message to stdout and the logFile if defined&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        print(msg)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a01ab9d5897f97b778c7df37bd76678f2">appendLog</a>(msg)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html#a01ab9d5897f97b778c7df37bd76678f2">   30</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1UO.html#a01ab9d5897f97b778c7df37bd76678f2">appendLog</a>(self, text):</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief add the text to the log file</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">           @param text The text to add to the log file&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a1f9f69d9f49237b89f708c27b962ef4b">_logFile</a>:</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            fd = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                <span class="keywordflow">if</span> os.path.isfile(self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a1f9f69d9f49237b89f708c27b962ef4b">_logFile</a>):</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                    fd = open(self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a1f9f69d9f49237b89f708c27b962ef4b">_logFile</a>, <span class="stringliteral">&quot;a&quot;</span>)</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                    fd = open(self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a1f9f69d9f49237b89f708c27b962ef4b">_logFile</a>, <span class="stringliteral">&quot;w&quot;</span>)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                timeStamp = time.strftime(<span class="stringliteral">&quot;%Y-%b-%d_%H_%M_%S&quot;</span>, time.gmtime())</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                fd.write(<span class="stringliteral">&quot;{}: {}\n&quot;</span>.format(timeStamp, text))</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <span class="keywordflow">finally</span>:</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                <span class="keywordflow">if</span> fd:</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                    fd.close()</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html#ae4c35c6d1bc1b379ab39c6265e1686dd">   49</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1UO.html#ae4c35c6d1bc1b379ab39c6265e1686dd">setLog</a>(self, logFile):</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Set the log file to be used to record all output</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral">           @param logFile The logFile to use&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#a1f9f69d9f49237b89f708c27b962ef4b">_logFile</a> = logFile</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html#a6edc5232564d5b50991ae6843068dc4f">   54</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1UO.html#a6edc5232564d5b50991ae6843068dc4f">info</a>(self, text):</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#af51668dfdd95fa2003fba0e994502c69">_output</a>( <span class="stringliteral">&#39;INFO:  &#39;</span>+str(text) )</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html#ad744e454b13b7a2264fb62327e87b368">   57</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1UO.html#ad744e454b13b7a2264fb62327e87b368">debug</a>(self, text):</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#af51668dfdd95fa2003fba0e994502c69">_output</a>( <span class="stringliteral">&#39;DEBUG: &#39;</span>+str(text) )</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html#a32632feeba36506bc455ad31ab73660f">   60</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1UO.html#a32632feeba36506bc455ad31ab73660f">warn</a>(self, text):</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#af51668dfdd95fa2003fba0e994502c69">_output</a>( <span class="stringliteral">&#39;WARN:  &#39;</span>+str(text) )</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1UO.html#ac521dab57b3049b913c529af83a7a781">   63</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1UO.html#ac521dab57b3049b913c529af83a7a781">error</a>(self, text):</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1UO.html#af51668dfdd95fa2003fba0e994502c69">_output</a>( <span class="stringliteral">&#39;ERROR: &#39;</span>+str(text) )</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1DiskUsage.html">   66</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html">DiskUsage</a>(object):</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;@brief Responsible for determining the disk usage.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1DiskUsage.html#a72f1fd9e2bf798d297befc4655c3f730">   68</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html#a72f1fd9e2bf798d297befc4655c3f730">__init__</a>(self, diskPath):</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Read the disk usage and save.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="stringliteral">           @param diskPath The path where the disk is mounted.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        self._totalBytes, self._usedBytes, self.<a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html#a5de9327a9dbe1e6f801b9c4a53052278">_freeBytes</a> = shutil.disk_usage(diskPath)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1DiskUsage.html#ad6e0b9ae5f0e41bb47fce0e366287636">   73</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html#ad6e0b9ae5f0e41bb47fce0e366287636">getTotalGB</a>(self):</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the disk size in GB</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">           @return The disk size in GB&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">return</span> self._totalBytes /(2**30)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1DiskUsage.html#a3f4b158112d553e26c4da756f8666838">   78</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html#a3f4b158112d553e26c4da756f8666838">getUsedGB</a>(self):</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get used disk space in GB</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">           @return The used disk space in GB&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">return</span> self._usedBytes /(2**30)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1DiskUsage.html#af433bfef54e41b46bc7344686f0e35b1">   83</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html#af433bfef54e41b46bc7344686f0e35b1">getFreeGB</a>(self):</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the free disk space in GB</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="stringliteral">           @return The free disk space in GB&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html#a5de9327a9dbe1e6f801b9c4a53052278">_freeBytes</a> /(2**30)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html">   88</a></span>&#160;<span class="keyword">class </span><a class="code" href="classpbackup_1_1backup_1_1Backup.html">Backup</a>(object):</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Responsible for providing backup functionality&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a93589a180ce52a14dad36e392d52031b">   91</a></span>&#160;    BACKUP_STATE_START              = 1</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a75b0c4039433247beffdf0016c412aad">   92</a></span>&#160;    BACKUP_STATE_SUCCESS            = 2</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#af056a33b1fd8cee276fdb0b1ed87c777">   93</a></span>&#160;    BACKUP_STATE_ERROR              = 3</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#afeab65651fa544517f43663f87895930">   95</a></span>&#160;    RSYNC_CMD                       = <span class="stringliteral">&quot;/usr/bin/rsync&quot;</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a562f9ce357eea61f0f57bd7ba9203bb4">   97</a></span>&#160;    FULL_BACKUP_DIR_TEXT            = <span class="stringliteral">&quot;FULL&quot;</span></div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#ab552050dc1b54f04a68c0f81fc9954f6">   98</a></span>&#160;    INCREMENTAL_BACKUP_DIR_TEXT     = <span class="stringliteral">&quot;INCR&quot;</span></div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#ab4a6a16c5c8ba721d77fc23cfc3e4fa0">   99</a></span>&#160;    BACKUP_SIZE_LOG_FILE            = <span class="stringliteral">&quot;backup_size.log&quot;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a98ed58c7bf0c8c0444b097569c41668c">  100</a></span>&#160;    BACKUP_LOG_FILE                 = <span class="stringliteral">&quot;backup.log&quot;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a2975d2f47a3113f0949505f5626cfa57">  101</a></span>&#160;    INCOMPLETE_BACKUP_SUFFIX        = <span class="stringliteral">&quot;incomplete&quot;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#acfd6c67a9e18750cdce119f10a01ab24">  102</a></span>&#160;    NOT_STARTED_BACKUP_SUFFIX       = <span class="stringliteral">&quot;not_started&quot;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#ab15a0a823ec4aab5c5ff7b2eabef5e6d">  104</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1Backup.html#ab15a0a823ec4aab5c5ff7b2eabef5e6d">__init__</a>(self, uo, options):</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Constructor</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">           @param uo = User output object for notifying user of progress</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral">           @param options = Command line options</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">           &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>        = uo</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>   = options</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#aa3c89abe045f84ae34b03197dd8765d2">_checkOptions</a>()</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keyword">def </span>_checkOptions(self):</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Check the required options have been entered by the user&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        showCmdLine = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.show_cmd_line</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.test_email:</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server:</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;To test the email you must define the email server.&quot;</span>)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordflow">return</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">#Load config is required to do so</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ab5a7056a75d8ca8fa792c36a92d7f970">_loadConfig</a>()</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span> showCmdLine:</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a9749fa02b9367cedba2abd833961cfaa">showCmdLine</a>()</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;Please define the src path on the command line.&quot;</span>)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment">#If the src path exists but does not end /. / at the end of the path ensures we copy the dir contents</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span>  os.path.isdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src) <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src.endswith(<span class="stringliteral">&quot;/&quot;</span>):</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src=<span class="stringliteral">&quot;{}/&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;Please define the dest path on the command line.&quot;</span>)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_full &lt; 2:</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;The minimum number of full backups that you can set is 2.&quot;</span>)</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_inc &lt; 0:</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;The minimum number of incremental backups cannot be negative.&quot;</span>)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">#Ensure local dest path exists</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest):</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.disable_create_dest:</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;{} path does not exist.&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest) )</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ac36fe347d7eaab3a76fe8f6e1993e388">_createDestPath</a>()</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.save_config <span class="keywordflow">and</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.load_config:</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;The save and load config command line options cannot be used at the same time.&quot;</span>)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_list:</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;If the email server is defined then you must define the email list&quot;</span>)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_list <span class="keywordflow">and</span> <span class="keywordflow">not</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server:</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;If the email list is defined then you must define the email server&quot;</span>)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a9749fa02b9367cedba2abd833961cfaa">  162</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1Backup.html#a9749fa02b9367cedba2abd833961cfaa">showCmdLine</a>(self):</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief show the command line. Useful when the user loaded the cmd line options from a file and</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="stringliteral">           needs to know the original command line&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        optionList = []</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        optionList.append( <span class="stringliteral">&quot;--src  {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src) )</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        optionList.append( <span class="stringliteral">&quot;--dest {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest) )</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src_exclude:</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            optionList.append( <span class="stringliteral">&quot;--src_exclude {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src_exclude) )</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.log:</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            optionList.append( <span class="stringliteral">&quot;--log {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.log) )</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_full:</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            optionList.append( <span class="stringliteral">&quot;--max_full {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_full) )</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_inc:</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            optionList.append( <span class="stringliteral">&quot;--max_inc {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_inc) )</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_list:</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            optionList.append( <span class="stringliteral">&quot;--email_list {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_list) )</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server:</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            optionList.append( <span class="stringliteral">&quot;--email_server {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server) )</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_username:</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            optionList.append( <span class="stringliteral">&quot;--email_username {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_username) )</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_password:</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            optionList.append( <span class="stringliteral">&quot;--email_password {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_password) )</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.pre_script:</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            optionList.append( <span class="stringliteral">&quot;--pre_script {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.pre_script) )</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.post_script:</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            optionList.append( <span class="stringliteral">&quot;--post_script {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.post_script) )</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.debug:</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            optionList.append( <span class="stringliteral">&quot;--debug {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.debug) )</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;Previous command line&quot;</span>)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        print(<span class="stringliteral">&quot; &quot;</span>.join(optionList))</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        sys.exit(0)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keyword">def </span>_createDestPath(self):</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Create dest path if it does not exist&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest):</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            os.makedirs(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest):</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;Failed to create dest path: {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest) )</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keyword">def </span>_notifyEmail(self, subjectMessage, body=&quot;&quot;):</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Responsible for notifying the user of the backup progress via email</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral">           @param subject The subject line of the notification email</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">           @param body The body text of the notification email&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        backupSrc, _ = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ab8fc6d7a8800fe77cf2844fdadfe1ed0">_getSrc</a>()</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        subject = <span class="stringliteral">&quot;{}: &#39;{}&#39; {}&quot;</span>.format(socket.gethostname(), backupSrc , subjectMessage)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server:</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            toList = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_list.split(<span class="stringliteral">&quot;,&quot;</span>)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a3d66557c42a83edee0d7a538df00d748">_sendMail</a>( self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server, self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_username, self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_password, toList, subject, body)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keyword">def </span>_getFullBackupID(self, backupDest):</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Given a backup dir name, extract the full backup ID</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="stringliteral">           @return The full backup ID or -1 if not found&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        fullNum = -1</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        fullBackupSubStr = <span class="stringliteral">&quot;.{}&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        pos = backupDest.find(fullBackupSubStr)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">if</span> pos &gt; 0:</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="comment">#Extract the full backup number</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            tmpStr = backupDest[pos+1:]</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            elems = tmpStr.split(<span class="stringliteral">&quot;_&quot;</span>)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                fullNum = int(elems[1])</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;Failed to extract the full backup number from {}&quot;</span>.format(backupDest) )</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">return</span> fullNum</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keyword">def </span>_getLastFullBackup(self):</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the last full backup from the destination directory.</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral">           @return The last full backup directory name or an empty string if no backup is present.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        backup=<span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        fullBackupID = -1</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">#Check for the latest backup</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <span class="comment">#Get the last full complete backup</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="keywordflow">if</span> entry.find(<span class="stringliteral">&quot;.{}&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT) ) != -1 <span class="keywordflow">and</span> entry.find(Backup.INCOMPLETE_BACKUP_SUFFIX) == -1:</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                thisFullBackupID = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a5fe2c2dc86f1cf40490379c00d832401">_getFullBackupID</a>(entry)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">if</span> fullBackupID == -1:</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    fullBackupID = thisFullBackupID</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    backup = entry</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <span class="keywordflow">elif</span> fullBackupID &lt; thisFullBackupID:</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                    fullBackupID = thisFullBackupID</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    backup = entry</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">return</span> backup</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keyword">def </span>_getIncBackupList(self, fullBackupID):</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get incremental backup list for the given full backup ID</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="stringliteral">           @param fullBackupID The fuill backup ID</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="stringliteral">           @return A list of incremental backups against the given full backup&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        incrBackupList = []</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="comment">#If this is the correct full backup and we have found an incremental backup</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">if</span> entry.find(<span class="stringliteral">&quot;.{}_{}&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT, fullBackupID)) != -1 <span class="keywordflow">and</span> entry.find(Backup.INCREMENTAL_BACKUP_DIR_TEXT) != -1:</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                incrBackupList.append(entry)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">return</span> incrBackupList</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keyword">def </span>_getIncrBackupID(self, backupDest):</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Given a backup dir name, extract the incremental backup ID</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="stringliteral">           @return The incremental backup ID or -1 if not found&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        incrNum = -1</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="comment">#If this incremental backup completed</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">if</span> backupDest.find(Backup.INCOMPLETE_BACKUP_SUFFIX) == -1:</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            incrBackupSubStr = <span class="stringliteral">&quot;_{}&quot;</span>.format(Backup.INCREMENTAL_BACKUP_DIR_TEXT)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            pos = backupDest.find(incrBackupSubStr)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">if</span> pos &gt; 0:</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <span class="comment">#Extract the incremental backup number</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                tmpStr = backupDest[pos+1:]</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                elems = tmpStr.split(<span class="stringliteral">&quot;_&quot;</span>)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    incrNum = int(elems[1])</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;Failed to extract the incremental backup number from {}&quot;</span>.format(backupDest) )</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">return</span> incrNum</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keyword">def </span>_getLastIncrBackup(self, fullBackupID):</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief get the last incremental backup with the given full backup ID</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="stringliteral">           @param fullBackupID The full backup ID</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">           @return The last incremental backup ID for the given full backup or an empty string if not found&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        incrBackupList = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ab0bbf1a87ad8574f263abef78a50f08d">_getIncBackupList</a>(fullBackupID)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        backup=<span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        incrBackupID = -1</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="comment">#Check for the latest backup</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> incrBackupList:</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            thisIncrBackupID = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a793c12e68920284c48030884500476a1">_getIncrBackupID</a>(entry)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordflow">if</span> incrBackupID == -1:</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                incrBackupID = thisIncrBackupID</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                backup = entry</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="keywordflow">elif</span> thisIncrBackupID &gt; incrBackupID:</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                incrBackupID = thisIncrBackupID</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                backup = entry</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">return</span> backup</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keyword">def </span>_getFullBackupDest(self, fullBackupID):</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief get the full backup destination path&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        timeStamp = time.strftime(<span class="stringliteral">&quot;%Y-%b-%d_%H_%M_%S&quot;</span>, time.gmtime())</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        backupDest = os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, <span class="stringliteral">&quot;{}.{}_{}&quot;</span>.format(timeStamp, Backup.FULL_BACKUP_DIR_TEXT, fullBackupID) )</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keywordflow">return</span> backupDest</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keyword">def </span>_getIncrBackupDest(self, fullBackupID, incrBackupID):</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief get the full backup destination path&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        timeStamp = time.strftime(<span class="stringliteral">&quot;%Y-%b-%d_%H_%M_%S&quot;</span>, time.gmtime())</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        backupDest = os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, <span class="stringliteral">&quot;{}.{}_{}_{}_{}&quot;</span>.format(timeStamp, Backup.FULL_BACKUP_DIR_TEXT, fullBackupID, Backup.INCREMENTAL_BACKUP_DIR_TEXT, incrBackupID) )</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">return</span> backupDest</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keyword">def </span>_sendMail(self, server, username, password, toList, subject, body):</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Send an email via an SMTP server</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral">           @param server The server name (E.G smtp.gmail.com). This string can include the</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral">                         server port number if required (E.G smtp.gmail.com:587)</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral">           @param username The username to be used in order to log into the SMTP server</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral">           @param password The password to be used in order to log into the SMTP server</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="stringliteral">           @param toList   A List of email addresses to send the email to</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral">           @param subject  The subject text line of the email</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="stringliteral">           @param body     The body text of the email</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="comment"># Prepare actual message</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        message = <span class="stringliteral">&quot;&quot;&quot;\From: {}\nTo: {}\nSubject: {}\n\n{}</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span>.format(username, <span class="stringliteral">&quot;, &quot;</span>.join(toList), subject, body)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            port = 587</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">if</span> server.find(<span class="stringliteral">&quot;:&quot;</span>) != -1:</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                elems = server.split(<span class="stringliteral">&quot;:&quot;</span>)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                server = elems[0]</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                port = int(elems[1])</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            server = smtplib.SMTP(<span class="stringliteral">&quot;smtp.gmail.com&quot;</span>, port) <span class="comment">#or port 465 doesn&#39;t seem to work!</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            server.ehlo()</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            server.starttls()</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="comment">#If we have a username and password, login to the email server</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keywordflow">if</span> username <span class="keywordflow">and</span> password:</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                server.login(username, password)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            server.sendmail(username, toList, message)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            server.close()</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;SUBJECT: {}&quot;</span>.format( subject ) )</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;BODY:    {}&quot;</span>.format( body ) )</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;Sent email to {} as backup status notification&quot;</span>.format( str(toList) ) )</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="comment">#We dont throw an error here or any error send email notifications could</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="comment">#break the backup process</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.error( e )</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keyword">def </span>_getBackupDest(self):</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the backup dir name</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="stringliteral">           @return a The backup destination path</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="stringliteral">           If no backup is present in the dest folder return the intitial full backup path</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="stringliteral">           If a full backup is present but we have not reached the max number of incremental backups</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="stringliteral">           return the next incremental backup path.</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="stringliteral">           If we have reached the max number of incremental backups return the next full backup path.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        backupDest = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        lastFullBackup      = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a85d4042bcbeb359c96371f44af8aff1d">_getLastFullBackup</a>()</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment">#If no full backup return full backup with ID = 1</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">if</span> len( lastFullBackup ) == 0:</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            backupDest = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a69e121167cfb9b3a9b6b3fdd55d1fcc4">_getFullBackupDest</a>(1)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            fullBackupID = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a5fe2c2dc86f1cf40490379c00d832401">_getFullBackupID</a>(lastFullBackup)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            incrBackup = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ad417987b90e75d08a19b9ff0965acd48">_getLastIncrBackup</a>(fullBackupID)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="comment">#If we are on the first day of the month then perform a full backup</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            now = datetime.datetime.today()</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">if</span> now.day == 1:</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                backupDest = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a69e121167cfb9b3a9b6b3fdd55d1fcc4">_getFullBackupDest</a>(fullBackupID+1)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="comment">#If no incremental backups are required then select next full backup</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="keywordflow">elif</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_inc == 0:</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                backupDest = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a69e121167cfb9b3a9b6b3fdd55d1fcc4">_getFullBackupDest</a>(fullBackupID+1)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="comment">#If no incr backup return incr backup with ID = 1</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="keywordflow">elif</span> len(incrBackup) == 0:</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                backupDest = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#af423704ec27191a8d361e615854646b3">_getIncrBackupDest</a>(fullBackupID, 1)</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                incrBackupID = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a793c12e68920284c48030884500476a1">_getIncrBackupID</a>(incrBackup)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                <span class="comment">#If all the incr backups have been done</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                <span class="keywordflow">if</span> incrBackupID &gt;= self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_inc:</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                    <span class="comment">#return the next full backup</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                    backupDest = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a69e121167cfb9b3a9b6b3fdd55d1fcc4">_getFullBackupDest</a>(fullBackupID+1)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    backupDest = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#af423704ec27191a8d361e615854646b3">_getIncrBackupDest</a>(fullBackupID, incrBackupID+1)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordflow">return</span> backupDest</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a24ab64b99008165da69d26dae347743e">  452</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1Backup.html#a24ab64b99008165da69d26dae347743e">renameBackup</a>(self, fullBackupID):</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Rename all backups to have a full backup ID one lower than their current full backup ID&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            fullBackupIDText = <span class="stringliteral">&quot;{}_{}&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT, fullBackupID)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            newFullBackupIDText = <span class="stringliteral">&quot;{}_{}&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT, fullBackupID-1)</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">if</span> entry.find(fullBackupIDText) != -1:</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                currentPath = os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, entry)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                newPath     = os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, entry)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                newPath     = newPath.replace(fullBackupIDText, newFullBackupIDText)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                cmd = <span class="stringliteral">&quot;mv {} {}&quot;</span>.format(currentPath, newPath)</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                cmdOutput = check_output(cmd, shell=<span class="keyword">True</span>, stderr=STDOUT)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(cmdOutput)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;Renamed {} as {}&quot;</span>.format(currentPath, newPath) )</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keyword">def </span>_getFullBackupCount(self):</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the number of full backups currently stored in the dest location&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        fullBackupCount = 0</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <span class="comment">#If this is a full backup path</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="keywordflow">if</span> entry.find(<span class="stringliteral">&quot;.{}_&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT) ) != -1 <span class="keywordflow">and</span> entry.find(<span class="stringliteral">&quot;_{}_&quot;</span>.format(Backup.INCREMENTAL_BACKUP_DIR_TEXT) ) == -1:</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                fullBackupCount=fullBackupCount+1</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">return</span> fullBackupCount</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keyword">def </span>_getBackupList(self):</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Return a list of all full and incremental backups that are stored, sorted into date order&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        fullBackupList = []</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">if</span> entry.find(<span class="stringliteral">&quot;.{}_&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT) ) != -1:</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                fullBackupList.append(entry)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        fullBackupList.sort()</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">return</span> fullBackupList</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">def </span>_purgeBackups(self):</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief A maximum number of full backups is defined. This ensure that we don&#39;t keep</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="stringliteral">                  more backups than are required. The oldest backups are removed to ensure this.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="comment">#Delete the old backup log file if it exists</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        oldBackupLogFile = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a69f0a924968e92ce3c62c0d7d43813f4">_getBackupSizeLogFile</a>()</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> os.path.isfile(oldBackupLogFile):</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            os.remove(oldBackupLogFile)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">while</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ad81525fcdcdb4ff5329fb50e893f0e55">_getFullBackupCount</a>()  &gt; self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_full:</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            backupList = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ad2b7b8f43322ab6a6759fb3438fb4e43">_getBackupList</a>()</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            oldestBackupID = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a5fe2c2dc86f1cf40490379c00d832401">_getFullBackupID</a>(backupList[0])</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <span class="comment">#Delete all backups that reference this full backup ID</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            <span class="keywordflow">for</span> backup <span class="keywordflow">in</span> backupList:</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="keywordflow">if</span> backup.find(<span class="stringliteral">&quot;.{}_{}&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT, oldestBackupID)) != -1:</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                    delPath = os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, backup)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                    cmd = <span class="stringliteral">&quot;rm -rf {}&quot;</span>.format(delPath)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    cmdOutput = check_output(cmd, shell=<span class="keyword">True</span>, stderr=STDOUT)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(cmdOutput)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;Removed {}&quot;</span>.format(delPath) )</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keyword">def </span>_getFullBackupPath(self, backupPath):</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the full backup path associated with this backup path.</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="stringliteral">           @param backupPath Could hold a full or incremental backup path.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="stringliteral">                  Incremental backup paths contain the name of the associated</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="stringliteral">                  full backup path with the incremental backup ID added</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="stringliteral">           @return The Full backup path&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="comment">#If backupPath is a full backup path</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        fullBackupIDPos = backupPath.find(<span class="stringliteral">&quot;.{}_&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT) )</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">if</span> fullBackupIDPos != -1 <span class="keywordflow">and</span> backupPath.find(<span class="stringliteral">&quot;_{}_&quot;</span>.format(Backup.INCREMENTAL_BACKUP_DIR_TEXT)) == -1:</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordflow">return</span> backupPath</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="comment">#Extract the full backup ID</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">if</span> fullBackupIDPos &gt; 0:</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            elems = backupPath[fullBackupIDPos:].split(<span class="stringliteral">&quot;_&quot;</span>)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            fullBackupIDStr = elems[1]</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                fullBackupID = int(fullBackupIDStr)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="keywordflow">except</span>:</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;{} is not a valid full backup ID extracted from {}&quot;</span>.format(fullBackupIDStr, backupPath) )</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                <span class="keywordflow">if</span> entry.endswith(<span class="stringliteral">&quot;{}_{}&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT, fullBackupID) ):</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    <span class="keywordflow">return</span> os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, entry)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;{} is not a valid backup path&quot;</span>.format(backupPath) )</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keyword">def </span>_getLastBackupPath(self, backupDest):</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the path of the last backup&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="comment">#Get the full backup path associated with this backup</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        lastFullBackup = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37c20d924d9de0777638e0bfd7c6e041">_getFullBackupPath</a>(backupDest)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="comment">#Check if the last backup we had was a full backup</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        pos = backupDest.find(<span class="stringliteral">&quot;_{}_&quot;</span>.format(Backup.INCREMENTAL_BACKUP_DIR_TEXT) )</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span> pos == -1:</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="comment">#If this is a full backup path</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="keywordflow">if</span> backupDest.find(<span class="stringliteral">&quot;.{}_&quot;</span>.format(Backup.FULL_BACKUP_DIR_TEXT) ) != -1:</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <span class="comment">#If so then return this backup</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                <span class="keywordflow">return</span> lastFullBackup</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;{} is not a full or incremental backup path ???&quot;</span>.format(backupDest) )</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="comment">#Extract the incremental backup number</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        incNumStr = backupDest[pos+6:]</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        incNumStr.rstrip(<span class="stringliteral">&quot;\r&quot;</span>)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        incNumStr.rstrip(<span class="stringliteral">&quot;\n&quot;</span>)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            incNum = int(incNumStr)</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">except</span> ValueError:</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;Failed to extract the incremental backup number from {}&quot;</span>.format(backupDest) )</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">if</span> incNum &gt; 0:</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            incNum = incNum -1</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        <span class="comment">#Search for this incremental backup</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        lastBackupPath = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="keywordflow">if</span> entry.endswith(<span class="stringliteral">&quot;_{}_{}&quot;</span>.format(Backup.INCREMENTAL_BACKUP_DIR_TEXT, incNum)):</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                lastBackupPath = entry</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                <span class="keywordflow">break</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">#If we found the incremental backup</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">if</span> lastBackupPath:</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="comment">#Build full backup path</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            lastBackupPath = os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, lastBackupPath)</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="comment">#Use last full backup</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            lastBackupPath = lastFullBackup</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">return</span> lastBackupPath</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keyword">def </span>_getSrc(self):</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the backup src string.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="stringliteral">           @return A tuple containing the backup source string followed by the sshPort (None if ssh not being used)&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        backupSrc = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160; </div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        sshPort = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.ssh:</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            <span class="comment">#Build src string from user input</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            hostName = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.ssh</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            username=getpass.getuser()</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="comment">#Get the username if supplied by the user</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            elems = hostName.split(<span class="stringliteral">&quot;@&quot;</span>)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordflow">if</span> len(elems) == 2:</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                username = elems[0]</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                hostName=hostName[len(username)+1:]</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            elems = hostName.split(<span class="stringliteral">&quot;:&quot;</span>)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="keywordflow">if</span> len(elems) == 2:</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                sshPort = int(elems[1])</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                hostName = elems[0]</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">elif</span> len(elems) == 1:</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                hostName = elems[0]</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;{} is an invalid ssh server (E.G server or username@server or username@server:22)&quot;</span>.format(hostName))</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            backupSrc = <span class="stringliteral">&quot;{}@{}:{}&quot;</span>.format(username, hostName, self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">return</span> (backupSrc, sshPort)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keyword">def </span>_getBackupsToday(self):</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the number of backups that have been created today&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        backupsToday = 0</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        dayStamp = time.strftime(<span class="stringliteral">&quot;%Y-%b-%d_&quot;</span>, time.gmtime())</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        entryList = os.listdir(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">for</span> entry <span class="keywordflow">in</span> entryList:</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">if</span> entry.find(dayStamp) != -1:</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                backupsToday=backupsToday+1</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">return</span> backupsToday</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keyword">def </span>_doBackup(self):</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Execute the rsync command to perform the backup&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        backupDest              = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        diskUsageBefore         = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        diskUsageAfter          = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        incompleteBackupDest    = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            startTime = time.time()</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            diskUsageBefore = <a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html">DiskUsage</a>(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            backupDest = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a15eb03d143e8b5e22b316fd0bd436708">_getBackupDest</a>()</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            incompleteBackupDest    = <span class="stringliteral">&quot;{}.{}&quot;</span>.format(backupDest, Backup.NOT_STARTED_BACKUP_SUFFIX)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            backupsToday = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a9cd0248dfcdeb2bf5c4167c9c427f869">_getBackupsToday</a>()</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            if( backupsToday &gt;= self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_daily_backups ):</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;{} backups have been created today. The maximum daily backup count (set on the command line) is {}. Therefore no more backups can be created today&quot;</span>.format(backupsToday, self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.max_daily_backups) )</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="comment">#If required run the script before the backup starts (usefull for setting up LVM snapshots)</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.pre_script:</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                cmdOutput = check_output(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.pre_script, shell=<span class="keyword">True</span>, stderr=STDOUT)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(cmdOutput)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; </div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            backupSrc, sshPort = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ab8fc6d7a8800fe77cf2844fdadfe1ed0">_getSrc</a>()</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;Backing up {} to {}&quot;</span>.format(backupSrc, backupDest) )</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="comment">#Get the full backup path associated with this backup</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            fullBackupPath = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37c20d924d9de0777638e0bfd7c6e041">_getFullBackupPath</a>(backupDest)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="comment">#If this is the full backup</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="keywordflow">if</span> backupDest == fullBackupPath:</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                cmd=<span class="stringliteral">&quot;{} -avh --safe-links --delete&quot;</span>.format(Backup.RSYNC_CMD)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                lastBackupPath = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a41162c7380c6c1864fe678fe83548ece">_getLastBackupPath</a>(backupDest)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                cmd=<span class="stringliteral">&quot;{} -avh --safe-links --delete --link-dest={}&quot;</span>.format(Backup.RSYNC_CMD, lastBackupPath)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160; </div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="comment">#If the user has defined an exclusion pattern</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src_exclude:</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                exludePatternList  = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.src_exclude.split(<span class="stringliteral">&quot;,&quot;</span>)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keywordflow">for</span> exludePattern <span class="keywordflow">in</span> exludePatternList:</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                    cmd=<span class="stringliteral">&quot;{} --exclude {}&quot;</span>.format(cmd, exludePattern)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="comment">#We set the backup destination with an incomplete suffix and then when the backup is complete</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            <span class="comment">#set it to the correct destination. This allows users to easily see if a backup did not complete</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            incompleteBackupDest = <span class="stringliteral">&quot;{}.{}&quot;</span>.format(backupDest, Backup.INCOMPLETE_BACKUP_SUFFIX)</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">if</span> sshPort:</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                cmd=<span class="stringliteral">&quot;{} -e \&quot;ssh -p {} -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\&quot; {} {}&quot;</span>.format(cmd, sshPort, backupSrc, incompleteBackupDest)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                cmd=<span class="stringliteral">&quot;{} {} {}&quot;</span>.format(cmd, backupSrc, incompleteBackupDest)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#aa2c43d268a370b14a2fc3c372afb1318">_notifyEmail</a>(<span class="stringliteral">&quot;Backup Started&quot;</span>, body=<span class="stringliteral">&quot;BACKUP COMMAND\n\n{}\n\n\nThe backup source is {}. The backup will be stored in the {} path&quot;</span>.format(cmd, backupSrc, backupDest) )</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;RSYNC CMD: {}&quot;</span>.format(cmd) )</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="comment">#Do the backup</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            cmdOutput = check_output(cmd, shell=<span class="keyword">True</span>, stderr=STDOUT)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(cmdOutput)</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            os.rename(incompleteBackupDest, backupDest)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            diskUsageAfter = <a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html">DiskUsage</a>(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ae53513daa562a57ad0716cb371fedd55">_saveDiskUsage</a>(backupDest, diskUsageBefore, diskUsageAfter, startTime)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            backupCompletedMessage = <span class="stringliteral">&quot;Backup Completed Successfully&quot;</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">if</span> diskUsageAfter.getFreeGB() &lt; (self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.low/1E3):</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                backupCompletedMessage =  <span class="stringliteral">&quot;{}  !!! Low Disk Space !!!&quot;</span>.format(backupCompletedMessage)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(backupCompletedMessage)</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#aa2c43d268a370b14a2fc3c372afb1318">_notifyEmail</a>(backupCompletedMessage, body=<span class="stringliteral">&quot;This backup has been stored in the {} path\n\n\n{}&quot;</span>.format(backupDest, self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a87dfece44390ce63d300247fd1e8ed90">_getBackupLog</a>() ) )</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="comment">#Purge old backups if required</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ab8054c59249463b607b9fc77c4d55ae6">_purgeBackups</a>()</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordflow">finally</span>:</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="comment">#If the backup failed, create the record of the backup space used</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> diskUsageAfter:</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                diskUsageAfter = <a class="code" href="classpbackup_1_1backup_1_1DiskUsage.html">DiskUsage</a>(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ae53513daa562a57ad0716cb371fedd55">_saveDiskUsage</a>(incompleteBackupDest, diskUsageBefore, diskUsageAfter, startTime)</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="comment">#If required run the script after the backup complete (usefull for closing down LVM snapshots)</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.post_script:</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                cmdOutput = check_output(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.post_script, shell=<span class="keyword">True</span>, stderr=STDOUT)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(cmdOutput)</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160; </div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keyword">def </span>_getBackupSizeLogFile(self):</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@return The name of the backup size log file.</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="stringliteral">                   This was the old log file name and is no longer used. If this</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral">                   file is found then it is deleted.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        <span class="keywordflow">return</span> os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, Backup.BACKUP_SIZE_LOG_FILE)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keyword">def </span>_getBackupLogFile(self):</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@return The name of the backup log file.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">return</span> os.path.join(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.dest, Backup.BACKUP_LOG_FILE)</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="keyword">def </span>_saveDiskUsage(self, backupDest, diskUsageBefore, diskUsageAfter, startTime):</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Save the disk usage in the dest backup dir</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="stringliteral">           @param backupDest The backup destination</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="stringliteral">           @param diskUsageBefore The disk usage before the backup was started</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="stringliteral">           @param diskUsageAfter The disk usage after the backup was completed or failed</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral">           @param startTime The start time of the backup in seconds</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral">           @return None&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        thisBackupName = backupDest.split(<span class="stringliteral">&#39;/&#39;</span>).pop()</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <span class="comment">#We calc the backup size as the drop in free space wheil the backup was running.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="comment">#Other processes could be using disk space while the backup is running but</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="comment">#for the moment this is the assumption made.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        backupSizeGB = diskUsageBefore.getFreeGB()-diskUsageAfter.getFreeGB()</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        timeStr = time.strftime(<span class="stringliteral">&quot;%H:%M:%S&quot;</span>, time.gmtime(time.time()-startTime) )</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        backupDetails = <span class="stringliteral">&quot;Disk: Free {:.1f} GB, Used {:.1f} GB, Backup Size {:.1f} GB, Took {}&quot;</span>.format( diskUsageAfter.getFreeGB(), diskUsageAfter.getUsedGB(), backupSizeGB, timeStr)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        line = <span class="stringliteral">&quot;{}: {}&quot;</span>.format(thisBackupName, backupDetails)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        backupSizeRecordLogFile = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ade630b3d7486610ca7ae2d33b6d8b0f9">_getBackupLogFile</a>()</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">if</span> os.path.isfile(backupSizeRecordLogFile):</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            fd = open(backupSizeRecordLogFile, <span class="stringliteral">&#39;a&#39;</span>)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            fd = open(backupSizeRecordLogFile, <span class="stringliteral">&#39;w&#39;</span>)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        fd.write(<span class="stringliteral">&quot;{}\n&quot;</span>.format(line) )</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        fd.close()</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(line)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160; </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keyword">def </span>_getBackupLog(self):</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Get the size of the backup over time</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="stringliteral">           @return the above&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        lines = []</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        backupSizeRecordLogFile = self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ade630b3d7486610ca7ae2d33b6d8b0f9">_getBackupLogFile</a>()</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">if</span> os.path.isfile(backupSizeRecordLogFile):</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            fd = open(backupSizeRecordLogFile, <span class="stringliteral">&#39;r&#39;</span>)</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            lines = fd.readlines()</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            fd.close()</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>.join(lines)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keyword">def </span>_saveConfig(self):</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Save all the command line options to a config file&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.save_config:</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            pickle.dump( self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>, open(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.save_config, <span class="stringliteral">&quot;wb&quot;</span>) )</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;Saved command line options to {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.save_config) )</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keyword">def </span>_loadConfig(self):</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Load the command line options saved previously to a config file&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.load_config:</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a> = pickle.load( open(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.load_config, <span class="stringliteral">&quot;rb&quot;</span>) )</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">_uo</a>.info(<span class="stringliteral">&quot;Loaded command line options from {}&quot;</span>.format(self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.load_config) )</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#aa902973791e81c8c4542da337b86289b">  803</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1Backup.html#aa902973791e81c8c4542da337b86289b">execute</a>(self):</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Called to execute the backup process&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isfile(Backup.RSYNC_CMD):</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classpbackup_1_1backup_1_1BackupError.html">BackupError</a>(<span class="stringliteral">&quot;{} file not found.&quot;</span>.format(Backup.RSYNC_CMD))</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;           self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#ac7997ad6203b03666537d957cd4a78ec">_doBackup</a>()</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160; </div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;           self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a9f95eb9d19027f11553ec231efac1028">_saveConfig</a>()</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">_options</a>.email_server:</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    eTextList=[]</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                    <span class="comment">#If we have some output from a check_output cmd</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                    <span class="keywordflow">if</span> hasattr(e, <span class="stringliteral">&#39;output&#39;</span>):</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                        <span class="comment">#Include this in the error text</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                        eTextList.append(e.output)</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    eTextList.append( str(e) )</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                    self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#aa2c43d268a370b14a2fc3c372afb1318">_notifyEmail</a>(<span class="stringliteral">&quot;Backup Failed&quot;</span>, body = <span class="stringliteral">&quot;{}\n\n\n{}&quot;</span>.format(<span class="stringliteral">&quot;\n&quot;</span>.join(eTextList), self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#a87dfece44390ce63d300247fd1e8ed90">_getBackupLog</a>()) )</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                <span class="keywordflow">except</span>:</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                    <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">raise</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno"><a class="line" href="classpbackup_1_1backup_1_1Backup.html#a4621597547bc5a5185536b75ee912a27">  830</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classpbackup_1_1backup_1_1Backup.html#a4621597547bc5a5185536b75ee912a27">testEmail</a>(self):</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;@brief Send a test email&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        self.<a class="code" href="classpbackup_1_1backup_1_1Backup.html#aa2c43d268a370b14a2fc3c372afb1318">_notifyEmail</a>(<span class="stringliteral">&quot;Backup Email Test&quot;</span>, body = <span class="stringliteral">&quot;TESTING BACKUP EMAIL SEND\n\n\n&quot;</span> )</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno"><a class="line" href="namespacepbackup_1_1backup.html#acdb57441eac1023ea99bb791e01b4619">  834</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespacepbackup_1_1backup.html#acdb57441eac1023ea99bb791e01b4619">main</a>():</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    uo = <a class="code" href="classpbackup_1_1backup_1_1UO.html">UO</a>()</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    opts=OptionParser(usage=<span class="stringliteral">&quot;\n\</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="stringliteral">     A command line backup tool that provides full and incremental backups using hard links\n\</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="stringliteral">     so that folders with a complete backup history are available. Rsync (/usr/bin/rsync)\n\</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="stringliteral">     must be installed (installed by default on most Linux distributions).&quot;</span>)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160; </div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--src&quot;</span>,                    help=<span class="stringliteral">&quot;Followed by the absolute path of the path to backup (required). This may include any regular expressions that can be used on the rsync src. See rsync documentation for more details of this.&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--dest&quot;</span>,                   help=<span class="stringliteral">&quot;Followed by the absolute path of the path to hold the backups. (required)&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--src_exclude&quot;</span>,            help=<span class="stringliteral">&quot;Followed by a comma separated list of exclude patterns to be passed to rsync in order to exclude files in the src path from the backup (optional). See rsync documentation for more details of this.&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--ssh&quot;</span>,                    help=<span class="stringliteral">&quot;Followed by the src ssh host address (optional). If supplied this can include the username, E.G username@myserver (if no username is supplied the current username will be used). This may also include the SSH port number E.G username@myserver:22&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--log&quot;</span>,                    help=<span class="stringliteral">&quot;Followed by the absolute path of the backup log file (optional).&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--max_full&quot;</span>,               help=<span class="stringliteral">&quot;Followed by the maximum number of full backups to store (default=4).&quot;</span>, type=<span class="stringliteral">&quot;int&quot;</span>, default=4)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--max_inc&quot;</span>,                help=<span class="stringliteral">&quot;Followed by the maximum number of incremental backups to store (default=92).&quot;</span>, type=<span class="stringliteral">&quot;int&quot;</span>, default=92)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--email_server&quot;</span>,           help=<span class="stringliteral">&quot;Followed by the email (SMTP) server for notification of backup progress (optional). The SMTP server address can include the port number of the SMTP server (E.G smtp.gmail.com:587).&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--email_list&quot;</span>,             help=<span class="stringliteral">&quot;Followed by a comma separated list of email addresses to be sent email notifications of backup progress (optional).&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--email_username&quot;</span>,         help=<span class="stringliteral">&quot;Followed by the email username for notification of backup progress (optional).&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--email_password&quot;</span>,         help=<span class="stringliteral">&quot;Followed by the email password for notification of backup progress (optional).&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--test_email&quot;</span>,             help=<span class="stringliteral">&quot;Send a test email to check the email works.&quot;</span>, action=<span class="stringliteral">&quot;store_true&quot;</span>)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--pre_script&quot;</span>,             help=<span class="stringliteral">&quot;Followed by the absolute path of a script to be executed before the backup (optional). This is usefull is LVM snapshots are used. The script can be used to create the snapshot .&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--post_script&quot;</span>,            help=<span class="stringliteral">&quot;Followed by the absolute path of a script to be executed after the backup (optional). This is usefull is LVM snapshots are used. The script can be used to remove the snapshot once the backup is complete.&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--save_config&quot;</span>,            help=<span class="stringliteral">&quot;Followed by the config file to save the current command line options into.&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--load_config&quot;</span>,            help=<span class="stringliteral">&quot;Followed by the config file to load all command line options from. If this option is used then no other command line options are required as they will all be loaded from the config file. This allows for a simpler command line once you&#39;ve got the backup you&#39;re after.&quot;</span>, default=<span class="keywordtype">None</span>)</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--show_cmd_line&quot;</span>,          help=<span class="stringliteral">&quot;Show the command line (excluding --save_config, --load_config --list_options) and exit. This is useful if the --load_config option is used and you wish to find the original command line.&quot;</span>, action=<span class="stringliteral">&quot;store_true&quot;</span>, default=<span class="keyword">False</span>)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--max_daily_backups&quot;</span>,      help=<span class="stringliteral">&quot;Followed by the maximum number of backups that can be taken in one day (default = 5). This ensures that no matter how many times backup is executed, the backups stored will be limited.&quot;</span>, type=<span class="stringliteral">&quot;int&quot;</span>, default=5)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--disable_create_dest&quot;</span>,    help=<span class="stringliteral">&quot;Disable the creation of the dest path if it does not exist. By default the dest path is created if it does not exist&quot;</span>, action=<span class="stringliteral">&quot;store_true&quot;</span>, default=<span class="keyword">False</span>)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160; </div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--low&quot;</span>,                    help=<span class="stringliteral">&quot;Low disk space threshold (MB). If the destination disk space drops below this then backup complete email messages will include a low disk space warning (default = 5000 MB).&quot;</span>, type=<span class="stringliteral">&quot;int&quot;</span>, default=5000)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    opts.add_option(<span class="stringliteral">&quot;--debug&quot;</span>,                  help=<span class="stringliteral">&quot;Enable debugging.&quot;</span>, action=<span class="stringliteral">&quot;store_true&quot;</span>, default=<span class="keyword">False</span>)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        (options, args) = opts.parse_args()</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="comment">#If defined set the log file</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="keywordflow">if</span> options.log:</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            uo.setLog(options.log)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        backup = <a class="code" href="classpbackup_1_1backup_1_1Backup.html">Backup</a>(uo, options)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="keywordflow">if</span> options.test_email:</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            backup.testEmail()</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            backup.execute()</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="comment">#If the program throws a system exit exception</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">except</span> SystemExit:</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">#Don&#39;t print error information if CTRL C pressed</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">except</span> KeyboardInterrupt:</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        eTextList=[]</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">#If we have some output from a check_output cmd</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordflow">if</span> hasattr(e, <span class="stringliteral">&#39;output&#39;</span>):</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            eTextList.append( str(e.output) )</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        eTextList.append( str(e) )</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        uo.error(<span class="stringliteral">&quot;\n&quot;</span>.join(eTextList))</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        <span class="keywordflow">if</span> options.debug:</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="keywordflow">raise</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="keywordflow">if</span> __name__== <span class="stringliteral">&#39;__main__&#39;</span>:</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <a class="code" href="namespacepbackup_1_1backup.html#acdb57441eac1023ea99bb791e01b4619">main</a>()</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a37c20d924d9de0777638e0bfd7c6e041"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a37c20d924d9de0777638e0bfd7c6e041">pbackup.backup.Backup._getFullBackupPath</a></div><div class="ttdeci">def _getFullBackupPath(self, backupPath)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00518">backup.py:518</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_a01ab9d5897f97b778c7df37bd76678f2"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#a01ab9d5897f97b778c7df37bd76678f2">pbackup.backup.UO.appendLog</a></div><div class="ttdeci">def appendLog(self, text)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00030">backup.py:30</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a9f95eb9d19027f11553ec231efac1028"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a9f95eb9d19027f11553ec231efac1028">pbackup.backup.Backup._saveConfig</a></div><div class="ttdeci">def _saveConfig(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00791">backup.py:791</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ad81525fcdcdb4ff5329fb50e893f0e55"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ad81525fcdcdb4ff5329fb50e893f0e55">pbackup.backup.Backup._getFullBackupCount</a></div><div class="ttdeci">def _getFullBackupCount(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00467">backup.py:467</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1BackupError_html"><div class="ttname"><a href="classpbackup_1_1backup_1_1BackupError.html">pbackup.backup.BackupError</a></div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00015">backup.py:15</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ade630b3d7486610ca7ae2d33b6d8b0f9"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ade630b3d7486610ca7ae2d33b6d8b0f9">pbackup.backup.Backup._getBackupLogFile</a></div><div class="ttdeci">def _getBackupLogFile(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00748">backup.py:748</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ab15a0a823ec4aab5c5ff7b2eabef5e6d"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ab15a0a823ec4aab5c5ff7b2eabef5e6d">pbackup.backup.Backup.__init__</a></div><div class="ttdeci">def __init__(self, uo, options)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00104">backup.py:104</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a793c12e68920284c48030884500476a1"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a793c12e68920284c48030884500476a1">pbackup.backup.Backup._getIncrBackupID</a></div><div class="ttdeci">def _getIncrBackupID(self, backupDest)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00297">backup.py:297</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_a6edc5232564d5b50991ae6843068dc4f"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#a6edc5232564d5b50991ae6843068dc4f">pbackup.backup.UO.info</a></div><div class="ttdeci">def info(self, text)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00054">backup.py:54</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_aa902973791e81c8c4542da337b86289b"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#aa902973791e81c8c4542da337b86289b">pbackup.backup.Backup.execute</a></div><div class="ttdeci">def execute(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00803">backup.py:803</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1DiskUsage_html_a72f1fd9e2bf798d297befc4655c3f730"><div class="ttname"><a href="classpbackup_1_1backup_1_1DiskUsage.html#a72f1fd9e2bf798d297befc4655c3f730">pbackup.backup.DiskUsage.__init__</a></div><div class="ttdeci">def __init__(self, diskPath)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00068">backup.py:68</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1DiskUsage_html_af433bfef54e41b46bc7344686f0e35b1"><div class="ttname"><a href="classpbackup_1_1backup_1_1DiskUsage.html#af433bfef54e41b46bc7344686f0e35b1">pbackup.backup.DiskUsage.getFreeGB</a></div><div class="ttdeci">def getFreeGB(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00083">backup.py:83</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_a1f9f69d9f49237b89f708c27b962ef4b"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#a1f9f69d9f49237b89f708c27b962ef4b">pbackup.backup.UO._logFile</a></div><div class="ttdeci">_logFile</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00022">backup.py:22</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a4621597547bc5a5185536b75ee912a27"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a4621597547bc5a5185536b75ee912a27">pbackup.backup.Backup.testEmail</a></div><div class="ttdeci">def testEmail(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00830">backup.py:830</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_a4d94847acb7b98bea7a74c809a640f8f"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#a4d94847acb7b98bea7a74c809a640f8f">pbackup.backup.UO._outputStore</a></div><div class="ttdeci">_outputStore</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00023">backup.py:23</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a41162c7380c6c1864fe678fe83548ece"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a41162c7380c6c1864fe678fe83548ece">pbackup.backup.Backup._getLastBackupPath</a></div><div class="ttdeci">def _getLastBackupPath(self, backupDest)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00548">backup.py:548</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a85d4042bcbeb359c96371f44af8aff1d"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a85d4042bcbeb359c96371f44af8aff1d">pbackup.backup.Backup._getLastFullBackup</a></div><div class="ttdeci">def _getLastFullBackup(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00252">backup.py:252</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html">pbackup.backup.UO</a></div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00019">backup.py:19</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ab5a7056a75d8ca8fa792c36a92d7f970"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ab5a7056a75d8ca8fa792c36a92d7f970">pbackup.backup.Backup._loadConfig</a></div><div class="ttdeci">def _loadConfig(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00797">backup.py:797</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_ad744e454b13b7a2264fb62327e87b368"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#ad744e454b13b7a2264fb62327e87b368">pbackup.backup.UO.debug</a></div><div class="ttdeci">def debug(self, text)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00057">backup.py:57</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a5fe2c2dc86f1cf40490379c00d832401"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a5fe2c2dc86f1cf40490379c00d832401">pbackup.backup.Backup._getFullBackupID</a></div><div class="ttdeci">def _getFullBackupID(self, backupDest)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00230">backup.py:230</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a3d66557c42a83edee0d7a538df00d748"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a3d66557c42a83edee0d7a538df00d748">pbackup.backup.Backup._sendMail</a></div><div class="ttdeci">def _sendMail(self, server, username, password, toList, subject, body)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00359">backup.py:359</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_ac521dab57b3049b913c529af83a7a781"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#ac521dab57b3049b913c529af83a7a781">pbackup.backup.UO.error</a></div><div class="ttdeci">def error(self, text)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00063">backup.py:63</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_ae64f0875afe3067b97ba370b354b9213"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#ae64f0875afe3067b97ba370b354b9213">pbackup.backup.UO.__init__</a></div><div class="ttdeci">def __init__(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00021">backup.py:21</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_ae4c35c6d1bc1b379ab39c6265e1686dd"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#ae4c35c6d1bc1b379ab39c6265e1686dd">pbackup.backup.UO.setLog</a></div><div class="ttdeci">def setLog(self, logFile)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00049">backup.py:49</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_aa2c43d268a370b14a2fc3c372afb1318"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#aa2c43d268a370b14a2fc3c372afb1318">pbackup.backup.Backup._notifyEmail</a></div><div class="ttdeci">def _notifyEmail(self, subjectMessage, body=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00219">backup.py:219</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ad417987b90e75d08a19b9ff0965acd48"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ad417987b90e75d08a19b9ff0965acd48">pbackup.backup.Backup._getLastIncrBackup</a></div><div class="ttdeci">def _getLastIncrBackup(self, fullBackupID)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00321">backup.py:321</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1DiskUsage_html_a3f4b158112d553e26c4da756f8666838"><div class="ttname"><a href="classpbackup_1_1backup_1_1DiskUsage.html#a3f4b158112d553e26c4da756f8666838">pbackup.backup.DiskUsage.getUsedGB</a></div><div class="ttdeci">def getUsedGB(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00078">backup.py:78</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ac7997ad6203b03666537d957cd4a78ec"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ac7997ad6203b03666537d957cd4a78ec">pbackup.backup.Backup._doBackup</a></div><div class="ttdeci">def _doBackup(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00651">backup.py:651</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a15eb03d143e8b5e22b316fd0bd436708"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a15eb03d143e8b5e22b316fd0bd436708">pbackup.backup.Backup._getBackupDest</a></div><div class="ttdeci">def _getBackupDest(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00395">backup.py:395</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a9cd0248dfcdeb2bf5c4167c9c427f869"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a9cd0248dfcdeb2bf5c4167c9c427f869">pbackup.backup.Backup._getBackupsToday</a></div><div class="ttdeci">def _getBackupsToday(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00638">backup.py:638</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ae53513daa562a57ad0716cb371fedd55"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ae53513daa562a57ad0716cb371fedd55">pbackup.backup.Backup._saveDiskUsage</a></div><div class="ttdeci">def _saveDiskUsage(self, backupDest, diskUsageBefore, diskUsageAfter, startTime)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00752">backup.py:752</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a69f0a924968e92ce3c62c0d7d43813f4"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a69f0a924968e92ce3c62c0d7d43813f4">pbackup.backup.Backup._getBackupSizeLogFile</a></div><div class="ttdeci">def _getBackupSizeLogFile(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00742">backup.py:742</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ab8054c59249463b607b9fc77c4d55ae6"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ab8054c59249463b607b9fc77c4d55ae6">pbackup.backup.Backup._purgeBackups</a></div><div class="ttdeci">def _purgeBackups(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00495">backup.py:495</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1DiskUsage_html"><div class="ttname"><a href="classpbackup_1_1backup_1_1DiskUsage.html">pbackup.backup.DiskUsage</a></div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00066">backup.py:66</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ac36fe347d7eaab3a76fe8f6e1993e388"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ac36fe347d7eaab3a76fe8f6e1993e388">pbackup.backup.Backup._createDestPath</a></div><div class="ttdeci">def _createDestPath(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00209">backup.py:209</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_aa3c89abe045f84ae34b03197dd8765d2"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#aa3c89abe045f84ae34b03197dd8765d2">pbackup.backup.Backup._checkOptions</a></div><div class="ttdeci">def _checkOptions(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00114">backup.py:114</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a9749fa02b9367cedba2abd833961cfaa"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a9749fa02b9367cedba2abd833961cfaa">pbackup.backup.Backup.showCmdLine</a></div><div class="ttdeci">def showCmdLine(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00162">backup.py:162</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ab8fc6d7a8800fe77cf2844fdadfe1ed0"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ab8fc6d7a8800fe77cf2844fdadfe1ed0">pbackup.backup.Backup._getSrc</a></div><div class="ttdeci">def _getSrc(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00601">backup.py:601</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a7f9a85e66fca8983938e3ef12b102552"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a7f9a85e66fca8983938e3ef12b102552">pbackup.backup.Backup._options</a></div><div class="ttdeci">_options</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00110">backup.py:110</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_a32632feeba36506bc455ad31ab73660f"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#a32632feeba36506bc455ad31ab73660f">pbackup.backup.UO.warn</a></div><div class="ttdeci">def warn(self, text)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00060">backup.py:60</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a87dfece44390ce63d300247fd1e8ed90"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a87dfece44390ce63d300247fd1e8ed90">pbackup.backup.Backup._getBackupLog</a></div><div class="ttdeci">def _getBackupLog(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00779">backup.py:779</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1UO_html_af51668dfdd95fa2003fba0e994502c69"><div class="ttname"><a href="classpbackup_1_1backup_1_1UO.html#af51668dfdd95fa2003fba0e994502c69">pbackup.backup.UO._output</a></div><div class="ttdeci">def _output(self, msg)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00025">backup.py:25</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a37b2976f2070fbdc23c02647ac6aca3b"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a37b2976f2070fbdc23c02647ac6aca3b">pbackup.backup.Backup._uo</a></div><div class="ttdeci">_uo</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00109">backup.py:109</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1DiskUsage_html_a5de9327a9dbe1e6f801b9c4a53052278"><div class="ttname"><a href="classpbackup_1_1backup_1_1DiskUsage.html#a5de9327a9dbe1e6f801b9c4a53052278">pbackup.backup.DiskUsage._freeBytes</a></div><div class="ttdeci">_freeBytes</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00071">backup.py:71</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_af423704ec27191a8d361e615854646b3"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#af423704ec27191a8d361e615854646b3">pbackup.backup.Backup._getIncrBackupDest</a></div><div class="ttdeci">def _getIncrBackupDest(self, fullBackupID, incrBackupID)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00353">backup.py:353</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html">pbackup.backup.Backup</a></div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00088">backup.py:88</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a24ab64b99008165da69d26dae347743e"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a24ab64b99008165da69d26dae347743e">pbackup.backup.Backup.renameBackup</a></div><div class="ttdeci">def renameBackup(self, fullBackupID)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00452">backup.py:452</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1DiskUsage_html_ad6e0b9ae5f0e41bb47fce0e366287636"><div class="ttname"><a href="classpbackup_1_1backup_1_1DiskUsage.html#ad6e0b9ae5f0e41bb47fce0e366287636">pbackup.backup.DiskUsage.getTotalGB</a></div><div class="ttdeci">def getTotalGB(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00073">backup.py:73</a></div></div>
<div class="ttc" id="anamespacepbackup_1_1backup_html_acdb57441eac1023ea99bb791e01b4619"><div class="ttname"><a href="namespacepbackup_1_1backup.html#acdb57441eac1023ea99bb791e01b4619">pbackup.backup.main</a></div><div class="ttdeci">def main()</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00834">backup.py:834</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ab0bbf1a87ad8574f263abef78a50f08d"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ab0bbf1a87ad8574f263abef78a50f08d">pbackup.backup.Backup._getIncBackupList</a></div><div class="ttdeci">def _getIncBackupList(self, fullBackupID)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00280">backup.py:280</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_ad2b7b8f43322ab6a6759fb3438fb4e43"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#ad2b7b8f43322ab6a6759fb3438fb4e43">pbackup.backup.Backup._getBackupList</a></div><div class="ttdeci">def _getBackupList(self)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00480">backup.py:480</a></div></div>
<div class="ttc" id="aclasspbackup_1_1backup_1_1Backup_html_a69e121167cfb9b3a9b6b3fdd55d1fcc4"><div class="ttname"><a href="classpbackup_1_1backup_1_1Backup.html#a69e121167cfb9b3a9b6b3fdd55d1fcc4">pbackup.backup.Backup._getFullBackupDest</a></div><div class="ttdeci">def _getFullBackupDest(self, fullBackupID)</div><div class="ttdef"><b>Definition:</b> <a href="backup_8py_source.html#l00347">backup.py:347</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
